# -*- coding: utf-8 -*-
"""utils.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17yyT20fjKG9vcbsyYzyUkBqhIXcnhLti
"""

import time

def invoke_with_retry(llm, prompt, max_retries=5, base_delay=5):
    for attempt in range(max_retries):
        try:
            response = llm.invoke(prompt)
            return response
        except Exception as e:
            if "429" in str(e) or "Too Many Requests" in str(e):
                delay = base_delay * (2 ** attempt)
                print(f"429 error encountered. Waiting {delay} seconds before retrying...")
                time.sleep(delay)
            else:
                raise
    raise Exception("Max retries exceeded due to repeated 429 errors.")